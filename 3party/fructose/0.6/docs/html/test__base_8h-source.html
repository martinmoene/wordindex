<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>FRUCTOSE: include/fructose/test_base.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.6 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>include/fructose/test_base.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* FRUCTOSE C++ unit test library. </span>
<a name="l00002"></a>00002 <span class="comment">Copyright (c) 2007 Andrew Peter Marlow. All rights reserved.</span>
<a name="l00003"></a>00003 <span class="comment">http://www.andrewpetermarlow.co.uk.</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">This library is free software; you can redistribute it and/or</span>
<a name="l00006"></a>00006 <span class="comment">modify it under the terms of the GNU Lesser General Public</span>
<a name="l00007"></a>00007 <span class="comment">License as published by the Free Software Foundation; either</span>
<a name="l00008"></a>00008 <span class="comment">version 2.1 of the License, or (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment"></span>
<a name="l00010"></a>00010 <span class="comment">This library is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00013"></a>00013 <span class="comment">Lesser General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment"></span>
<a name="l00015"></a>00015 <span class="comment">You should have received a copy of the GNU Lesser General Public</span>
<a name="l00016"></a>00016 <span class="comment">License along with this library; if not, write to the Free Software</span>
<a name="l00017"></a>00017 <span class="comment">Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA</span>
<a name="l00018"></a>00018 <span class="comment">*/</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#ifndef INCLUDED_FRUCTOSE_TEST_BASE</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#define INCLUDED_FRUCTOSE_TEST_BASE</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span>
<a name="l00023"></a>00023 <span class="preprocessor">#include "fructose/test_root.h"</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00031"></a>00031 
<a name="l00150"></a>00150 <span class="keyword">namespace </span>fructose {
<a name="l00151"></a>00151 
<a name="l00258"></a>00258 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> test_container&gt;
<a name="l00259"></a><a class="code" href="classfructose_1_1test__base.html">00259</a> <span class="keyword">class </span><a class="code" href="classfructose_1_1test__base.html">test_base</a> : <span class="keyword">public</span> <a class="code" href="classfructose_1_1test__root.html">test_root</a>
<a name="l00260"></a>00260 {
<a name="l00261"></a>00261 <span class="keyword">public</span>:    
<a name="l00262"></a>00262 
<a name="l00271"></a><a class="code" href="classfructose_1_1test__base.html#696e7bf639f2a82053e8529eab26ab1e">00271</a>     <span class="keyword">typedef</span> void (test_container::*<a class="code" href="classfructose_1_1test__base.html#696e7bf639f2a82053e8529eab26ab1e">test_case</a>)(<span class="keyword">const</span> std::string&amp;);
<a name="l00272"></a>00272     
<a name="l00273"></a>00273     <span class="comment">// compiler-generated default constructor and destructor are OK</span>
<a name="l00274"></a>00274         
<a name="l00284"></a>00284     <span class="keywordtype">void</span> <a class="code" href="classfructose_1_1test__base.html#30560442a7c4c8c495e2bd7cff352cdd">add_test</a>(<span class="keyword">const</span> std::string&amp; name, <a class="code" href="classfructose_1_1test__base.html#696e7bf639f2a82053e8529eab26ab1e">test_case</a> the_test);
<a name="l00285"></a>00285     
<a name="l00295"></a>00295     <span class="keywordtype">int</span> <a class="code" href="classfructose_1_1test__base.html#bd2e9bcf3098f22ce4ff6bb44218ddfd">run</a>();
<a name="l00296"></a>00296 
<a name="l00303"></a>00303     <span class="keywordtype">int</span> <a class="code" href="classfructose_1_1test__base.html#bd2e9bcf3098f22ce4ff6bb44218ddfd">run</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]);
<a name="l00304"></a>00304 
<a name="l00317"></a>00317     <span class="keywordtype">int</span> <a class="code" href="classfructose_1_1test__base.html#bd2e9bcf3098f22ce4ff6bb44218ddfd">run</a>(<span class="keyword">const</span> <a class="code" href="classfructose_1_1test__root.html#bb7a988db4e5ea2c8a8d52173947ed23">suite</a>&amp; <a class="code" href="classfructose_1_1test__root.html#bb7a988db4e5ea2c8a8d52173947ed23">suite</a>);
<a name="l00318"></a>00318     
<a name="l00337"></a>00337     <a class="code" href="classfructose_1_1test__root.html#bb7a988db4e5ea2c8a8d52173947ed23">suite</a> <a class="code" href="classfructose_1_1test__base.html#7b41fc2ae3f64bcc5139cb74830aeffa">get_suite</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]);
<a name="l00338"></a>00338     
<a name="l00339"></a>00339 <span class="keyword">private</span>:    
<a name="l00340"></a>00340 
<a name="l00346"></a>00346     <span class="keywordtype">int</span> do_run(<span class="keyword">const</span> <a class="code" href="classfructose_1_1test__root.html#bb7a988db4e5ea2c8a8d52173947ed23">suite</a>&amp; <a class="code" href="classfructose_1_1test__root.html#bb7a988db4e5ea2c8a8d52173947ed23">suite</a>);
<a name="l00347"></a>00347 
<a name="l00351"></a>00351     std::map&lt;std::string, test_case&gt; m_tests;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353     <span class="comment">/*</span>
<a name="l00354"></a>00354 <span class="comment">     * Defines the sequence in which tests have to be run.</span>
<a name="l00355"></a>00355 <span class="comment">     */</span>
<a name="l00356"></a>00356     <a class="code" href="classfructose_1_1test__root.html#bb7a988db4e5ea2c8a8d52173947ed23">suite</a> m_available_tests;
<a name="l00357"></a>00357 };
<a name="l00358"></a>00358 
<a name="l00359"></a>00359 <span class="comment">// ====================</span>
<a name="l00360"></a>00360 <span class="comment">// INLINE definitions</span>
<a name="l00361"></a>00361 <span class="comment">// ====================</span>
<a name="l00362"></a>00362 
<a name="l00363"></a>00363 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> test_container&gt;
<a name="l00364"></a>00364 <span class="keyword">inline</span> <span class="keywordtype">void</span> 
<a name="l00365"></a><a class="code" href="classfructose_1_1test__base.html#30560442a7c4c8c495e2bd7cff352cdd">00365</a> <a class="code" href="classfructose_1_1test__base.html">test_base&lt;test_container&gt;::add_test</a>(<span class="keyword">const</span> std::string&amp; name, 
<a name="l00366"></a>00366                                     test_case the_test)
<a name="l00367"></a>00367 {
<a name="l00368"></a>00368     m_tests[name] = the_test;
<a name="l00369"></a>00369     m_available_tests.push_back(name);
<a name="l00370"></a>00370 }
<a name="l00371"></a>00371     
<a name="l00372"></a>00372 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> test_container&gt;
<a name="l00373"></a>00373 <span class="keyword">inline</span> <span class="keywordtype">int</span> 
<a name="l00374"></a><a class="code" href="classfructose_1_1test__base.html#bd2e9bcf3098f22ce4ff6bb44218ddfd">00374</a> <a class="code" href="classfructose_1_1test__base.html">test_base&lt;test_container&gt;::run</a>()
<a name="l00375"></a>00375 {
<a name="l00376"></a>00376     <span class="keywordflow">return</span> <a class="code" href="classfructose_1_1test__base.html#bd2e9bcf3098f22ce4ff6bb44218ddfd">run</a>(m_available_tests);    
<a name="l00377"></a>00377 }
<a name="l00378"></a>00378 
<a name="l00379"></a>00379 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> test_container&gt;
<a name="l00380"></a>00380 <span class="keyword">inline</span> <span class="keywordtype">int</span> 
<a name="l00381"></a><a class="code" href="classfructose_1_1test__base.html#1e71f643ce9403eaef70befedc068daa">00381</a> <a class="code" href="classfructose_1_1test__base.html">test_base&lt;test_container&gt;::run</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])
<a name="l00382"></a>00382 {
<a name="l00383"></a>00383     <a class="code" href="classfructose_1_1test__root.html#bb7a988db4e5ea2c8a8d52173947ed23">test_root::suite</a> the_suite = <a class="code" href="classfructose_1_1test__base.html#7b41fc2ae3f64bcc5139cb74830aeffa">get_suite</a>(argc, argv);
<a name="l00384"></a>00384     <span class="keywordflow">return</span> <a class="code" href="classfructose_1_1test__base.html#bd2e9bcf3098f22ce4ff6bb44218ddfd">run</a>(the_suite);
<a name="l00385"></a>00385 }
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> test_container&gt;
<a name="l00388"></a>00388 <span class="keyword">inline</span> <span class="keywordtype">int</span> 
<a name="l00389"></a><a class="code" href="classfructose_1_1test__base.html#7f62476b5b76f573ad6eab2adcbab476">00389</a> <a class="code" href="classfructose_1_1test__base.html">test_base&lt;test_container&gt;::run</a>(<span class="keyword">const</span> suite&amp; suite) 
<a name="l00390"></a>00390 {
<a name="l00391"></a>00391     <span class="keywordflow">try</span>
<a name="l00392"></a>00392     {
<a name="l00393"></a>00393         <span class="keywordflow">return</span> do_run(suite);
<a name="l00394"></a>00394     }
<a name="l00395"></a>00395     <span class="keywordflow">catch</span>(...)
<a name="l00396"></a>00396     {
<a name="l00397"></a>00397         <span class="keywordflow">return</span> <a class="code" href="classfructose_1_1test__root.html#70fc25929dd3073b454517feab696cce">fructose::test_root::exception_handler</a>();
<a name="l00398"></a>00398     }
<a name="l00399"></a>00399 }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> test_container&gt;
<a name="l00402"></a>00402 <span class="keyword">inline</span> <span class="keywordtype">int</span> 
<a name="l00403"></a>00403 <a class="code" href="classfructose_1_1test__base.html">test_base&lt;test_container&gt;::do_run</a>(<span class="keyword">const</span> suite&amp; suite) 
<a name="l00404"></a>00404 {
<a name="l00405"></a>00405     test_container* runner = dynamic_cast&lt;test_container*&gt;(<span class="keyword">this</span>);
<a name="l00406"></a>00406     
<a name="l00407"></a>00407     <span class="keywordflow">if</span> (runner == 0)
<a name="l00408"></a>00408     {
<a name="l00409"></a>00409         <span class="keywordflow">throw</span> std::runtime_error(
<a name="l00410"></a>00410             <span class="stringliteral">"problem in test set-up; probable cause: "</span>
<a name="l00411"></a>00411             <span class="stringliteral">"test container class not passed to test_base template"</span>);
<a name="l00412"></a>00412     }
<a name="l00413"></a>00413 
<a name="l00414"></a>00414     <span class="keywordflow">for</span> (<span class="keyword">typename</span> suite::const_iterator it = suite.begin(); 
<a name="l00415"></a>00415          it != suite.end(); ++it)
<a name="l00416"></a>00416     {
<a name="l00417"></a>00417         <a class="code" href="classfructose_1_1test__base.html#696e7bf639f2a82053e8529eab26ab1e">test_case</a> <a class="code" href="classfructose_1_1test__base.html#696e7bf639f2a82053e8529eab26ab1e">test_case</a> = m_tests[*it];
<a name="l00418"></a>00418         <span class="keywordflow">if</span> (<a class="code" href="classfructose_1_1test__base.html#696e7bf639f2a82053e8529eab26ab1e">test_case</a>)
<a name="l00419"></a>00419         {
<a name="l00420"></a>00420             <span class="keyword">const</span> std::string title = <span class="stringliteral">"Running test case "</span> + *it;
<a name="l00421"></a>00421               
<a name="l00422"></a>00422             <span class="keywordflow">if</span> (<a class="code" href="classfructose_1_1test__root.html#d599f1c6a610e811991b8bd40d9a32bf">verbose</a>())
<a name="l00423"></a>00423                 std::cout &lt;&lt; std::endl &lt;&lt; title &lt;&lt; std::endl
<a name="l00424"></a>00424                           &lt;&lt; <a class="code" href="classfructose_1_1test__root.html#ee299aa5cea3f7dbdaa8d68c41c5f7ff">underline</a>(title) &lt;&lt; <span class="charliteral">'\n'</span> &lt;&lt; std::endl;
<a name="l00425"></a>00425             runner-&gt;setup();
<a name="l00426"></a>00426             runner-&gt;set_test_name(*it);
<a name="l00427"></a>00427             <span class="keywordflow">try</span>
<a name="l00428"></a>00428             {
<a name="l00429"></a>00429                 (runner-&gt;*test_case)(*it);    
<a name="l00430"></a>00430                 runner-&gt;teardown();
<a name="l00431"></a>00431             }
<a name="l00432"></a>00432             <span class="keywordflow">catch</span>(std::exception&amp;)
<a name="l00433"></a>00433             {
<a name="l00434"></a>00434                 runner-&gt;teardown();
<a name="l00435"></a>00435                 <span class="keywordflow">throw</span>;
<a name="l00436"></a>00436             }
<a name="l00437"></a>00437         }
<a name="l00438"></a>00438         <span class="keywordflow">else</span>
<a name="l00439"></a>00439         {
<a name="l00440"></a>00440             std::cerr &lt;&lt; <span class="stringliteral">"No such test case: "</span> &lt;&lt; *it &lt;&lt; std::endl;
<a name="l00441"></a>00441         }
<a name="l00442"></a>00442     }
<a name="l00443"></a>00443     
<a name="l00444"></a>00444     <span class="keywordflow">return</span> return_status();
<a name="l00445"></a>00445 }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> test_container&gt;
<a name="l00448"></a>00448 <span class="keyword">inline</span> 
<a name="l00449"></a><a class="code" href="classfructose_1_1test__base.html#7b41fc2ae3f64bcc5139cb74830aeffa">00449</a> test_root::suite <a class="code" href="classfructose_1_1test__base.html">test_base&lt;test_container&gt;::get_suite</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])
<a name="l00450"></a>00450 {
<a name="l00451"></a>00451     <span class="keywordflow">return</span> <a class="code" href="classfructose_1_1test__root.html#bc4c18fe1ea77af92e6f5bfea0eb7c09">do_get_suite</a>(m_available_tests, argc, argv);    
<a name="l00452"></a>00452 }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 } <span class="comment">// namespace</span>
<a name="l00455"></a>00455 
<a name="l00456"></a>00456 <span class="comment">// Macros for test harness code generator.</span>
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 <span class="preprocessor">#define FRUCTOSE_STRUCT(name) struct name : public fructose::test_base&lt;name&gt;</span>
<a name="l00459"></a>00459 <span class="preprocessor"></span><span class="preprocessor">#define FRUCTOSE_CLASS(name) class name : public fructose::test_base&lt;name&gt;</span>
<a name="l00460"></a>00460 <span class="preprocessor"></span><span class="preprocessor">#define FRUCTOSE_TEST(name) void name(const std::string&amp; test_name)</span>
<a name="l00461"></a>00461 <span class="preprocessor"></span>
<a name="l00462"></a>00462 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Jul 22 14:16:39 2007 for FRUCTOSE by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.6 </small></address>
</body>
</html>
